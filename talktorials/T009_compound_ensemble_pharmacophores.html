
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#2196f3">
  <script src="../_static/javascripts/modernizr.js"></script>
  
    <script async src="../_static/cookieconsent.min.js"></script>
    <script>
        window.addEventListener("load", function(){
        window.cookieconsent.initialise({
            "palette": {
            "popup": {
                "background": "#f0f0f0",
                "text": "#999"
            },
            "button": {
                "text": "#fff",
                "background": "#009688"
            }
            },
            "theme": "classic"
        })});
    </script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-Q6ZE82CNZB"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-Q6ZE82CNZB');
    </script>
  
    <link rel="apple-touch-icon" href="../_static/images/apple-icon-152x152.png"/>
  
  
    <title>T009 ¬∑ Ligand-based pharmacophores &#8212; TeachOpenCADD 0 documentation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/material.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="T010 ¬∑ Binding site similarity and off-target prediction" href="T010_binding_site_comparison.html" />
    <link rel="prev" title="T008 ¬∑ Protein data acquisition: Protein Data Bank (PDB)" href="T008_query_pdb.html" />
  
    <link rel="apple-touch-icon" href="../_static/images/apple-icon-152x152.png"/>
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=teal data-md-color-accent=cyan>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#talktorials/T009_compound_ensemble_pharmacophores" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../index.html" title="TeachOpenCADD 0 documentation"
           class="md-header-nav__button md-logo">
          
            <i class="md-icon">school</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">TeachOpenCADD (WIP üöß)</span>
          <span class="md-header-nav__topic"> T009 ¬∑ Ligand-based pharmacophores </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../search.html" method="GET" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://github.com/volkamerlab/teachopencadd/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    TeachOpenCADD
  </div>
</a>
          </div>
        </div>
      
      
    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
            
            <li class="md-tabs__item"><a href="../talktorials.html" class="md-tabs__link">Our talktorials</a></li>
            
            <li class="md-tabs__item"><a href="../installing.html" class="md-tabs__link">Run locally</a></li>
            
            <li class="md-tabs__item"><a href="../contribute.html" class="md-tabs__link">Contribute</a></li>
          <li class="md-tabs__item"><a href="../talktorials.html" class="md-tabs__link">Talktorials by collection</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../index.html" title="TeachOpenCADD 0 documentation" class="md-nav__button md-logo">
      
        <i class="md-icon">school</i>
      
    </a>
    <a href="../index.html"
       title="TeachOpenCADD 0 documentation">TeachOpenCADD (WIP üöß)</a>
  </label>
    <div class="md-nav__source">
      <a href="https://github.com/volkamerlab/teachopencadd/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    TeachOpenCADD
  </div>
</a>
    </div>
  
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">Our talktorials</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../talktorials.html" class="md-nav__link">Talktorials by collection</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../all_talktorials.html" class="md-nav__link">Complete list of talktorials</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="T001_query_chembl.html" class="md-nav__link">T001 ¬∑ Compound data acquisition (ChEMBL)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="T002_compound_adme.html" class="md-nav__link">T002 ¬∑ Molecular filtering: ADME and lead-likeness criteria</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="T003_compound_unwanted_substructures.html" class="md-nav__link">T003 ¬∑ Molecular filtering: unwanted substructures</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="T004_compound_similarity.html" class="md-nav__link">T004 ¬∑ Ligand-based screening: compound similarity</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="T005_compound_clustering.html" class="md-nav__link">T005 ¬∑ Compound clustering</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="T006_compound_maximum_common_substructures.html" class="md-nav__link">T006 ¬∑ Maximum common substructure</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="T007_compound_activity_machine_learning.html" class="md-nav__link">T007 ¬∑ Ligand-based screening: machine learning</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="T008_query_pdb.html" class="md-nav__link">T008 ¬∑ Protein data acquisition: Protein Data Bank (PDB)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    <label class="md-nav__link md-nav__link--active" for="__toc"> T009 ¬∑ Ligand-based pharmacophores </label>
    
      <a href="#" class="md-nav__link md-nav__link--active">T009 ¬∑ Ligand-based pharmacophores</a>
      
        
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#talktorials-t009-compound-ensemble-pharmacophores--page-root" class="md-nav__link">T009 ¬∑ Ligand-based pharmacophores</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Aim-of-this-talktorial" class="md-nav__link">Aim of this talktorial</a>
        </li>
        <li class="md-nav__item"><a href="#Learning-goals" class="md-nav__link">Learning goals</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Contents-in-Theory" class="md-nav__link">Contents in <em>Theory</em></a>
        </li>
        <li class="md-nav__item"><a href="#Contents-in-Practical" class="md-nav__link">Contents in <em>Practical</em></a>
        </li>
        <li class="md-nav__item"><a href="#References" class="md-nav__link">References</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#Theory" class="md-nav__link">Theory</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Pharmacophores" class="md-nav__link">Pharmacophores</a>
        </li>
        <li class="md-nav__item"><a href="#Structure--and-ligand-based-pharmacophore-modeling" class="md-nav__link">Structure- and ligand-based pharmacophore modeling</a>
        </li>
        <li class="md-nav__item"><a href="#Virtual-screening-with-pharmacophores" class="md-nav__link">Virtual screening with pharmacophores</a>
        </li>
        <li class="md-nav__item"><a href="#Clustering:-k-means" class="md-nav__link">Clustering: k-means</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#Practical" class="md-nav__link">Practical</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Get-pre-aligned-ligands-from-previous-talktorial" class="md-nav__link">Get pre-aligned ligands from previous talktorial</a>
        </li>
        <li class="md-nav__item"><a href="#Visualize-with-nglview" class="md-nav__link">Visualize with <code class="docutils literal notranslate"><span class="pre">nglview</span></code></a>
        </li>
        <li class="md-nav__item"><a href="#Extract-pharmacophore-features" class="md-nav__link">Extract pharmacophore features</a>
        </li>
        <li class="md-nav__item"><a href="#Show-the-pharmacophore-features-of-all-ligands" class="md-nav__link">Show the pharmacophore features of all ligands</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Hydrogen-bond-donors" class="md-nav__link">Hydrogen bond donors</a>
        </li>
        <li class="md-nav__item"><a href="#Hydrogen-bond-acceptors" class="md-nav__link">Hydrogen bond acceptors</a>
        </li>
        <li class="md-nav__item"><a href="#Hydrophobic-contacts" class="md-nav__link">Hydrophobic contacts</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#Collect-coordinates-of-features-per-feature-type" class="md-nav__link">Collect coordinates of features per feature type</a>
        </li>
        <li class="md-nav__item"><a href="#Generate-ensemble-pharmacophores" class="md-nav__link">Generate ensemble pharmacophores</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Set-static-parameters-for-k-means-clustering" class="md-nav__link">Set static parameters for k-means clustering</a>
        </li>
        <li class="md-nav__item"><a href="#Set-static-parameters-for-cluster-selection" class="md-nav__link">Set static parameters for cluster selection</a>
        </li>
        <li class="md-nav__item"><a href="#Define-k-means-clustering-and-cluster-selection-functions" class="md-nav__link">Define k-means clustering and cluster selection functions</a>
        </li>
        <li class="md-nav__item"><a href="#Cluster-features" class="md-nav__link">Cluster features</a>
        </li>
        <li class="md-nav__item"><a href="#Select-relevant-clusters" class="md-nav__link">Select relevant clusters</a>
        </li>
        <li class="md-nav__item"><a href="#Get-selected-cluster-coordinates" class="md-nav__link">Get selected cluster coordinates</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#Show-clusters" class="md-nav__link">Show clusters</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#id1" class="md-nav__link">Hydrogen bond donors</a>
        </li>
        <li class="md-nav__item"><a href="#Hydrogen-bond-acceptor" class="md-nav__link">Hydrogen bond acceptor</a>
        </li>
        <li class="md-nav__item"><a href="#id2" class="md-nav__link">Hydrophobic contacts</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#Show-ensemble-pharmacophore" class="md-nav__link">Show ensemble pharmacophore</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#Discussion" class="md-nav__link">Discussion</a>
        </li>
        <li class="md-nav__item"><a href="#Quiz" class="md-nav__link">Quiz</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../_sources/talktorials/T009_compound_ensemble_pharmacophores.nblink.txt">Show Source</a> </li>

  </ul>
</nav>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="T010_binding_site_comparison.html" class="md-nav__link">T010 ¬∑ Binding site similarity and off-target prediction</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">Run locally</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../installing.html" class="md-nav__link">Installing</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">Contributors</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../contribute.html" class="md-nav__link">For contributors</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../api.html" class="md-nav__link">API Documentation</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#talktorials-t009-compound-ensemble-pharmacophores--page-root" class="md-nav__link">T009 ¬∑ Ligand-based pharmacophores</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Aim-of-this-talktorial" class="md-nav__link">Aim of this talktorial</a>
        </li>
        <li class="md-nav__item"><a href="#Learning-goals" class="md-nav__link">Learning goals</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Contents-in-Theory" class="md-nav__link">Contents in <em>Theory</em></a>
        </li>
        <li class="md-nav__item"><a href="#Contents-in-Practical" class="md-nav__link">Contents in <em>Practical</em></a>
        </li>
        <li class="md-nav__item"><a href="#References" class="md-nav__link">References</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#Theory" class="md-nav__link">Theory</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Pharmacophores" class="md-nav__link">Pharmacophores</a>
        </li>
        <li class="md-nav__item"><a href="#Structure--and-ligand-based-pharmacophore-modeling" class="md-nav__link">Structure- and ligand-based pharmacophore modeling</a>
        </li>
        <li class="md-nav__item"><a href="#Virtual-screening-with-pharmacophores" class="md-nav__link">Virtual screening with pharmacophores</a>
        </li>
        <li class="md-nav__item"><a href="#Clustering:-k-means" class="md-nav__link">Clustering: k-means</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#Practical" class="md-nav__link">Practical</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Get-pre-aligned-ligands-from-previous-talktorial" class="md-nav__link">Get pre-aligned ligands from previous talktorial</a>
        </li>
        <li class="md-nav__item"><a href="#Visualize-with-nglview" class="md-nav__link">Visualize with <code class="docutils literal notranslate"><span class="pre">nglview</span></code></a>
        </li>
        <li class="md-nav__item"><a href="#Extract-pharmacophore-features" class="md-nav__link">Extract pharmacophore features</a>
        </li>
        <li class="md-nav__item"><a href="#Show-the-pharmacophore-features-of-all-ligands" class="md-nav__link">Show the pharmacophore features of all ligands</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Hydrogen-bond-donors" class="md-nav__link">Hydrogen bond donors</a>
        </li>
        <li class="md-nav__item"><a href="#Hydrogen-bond-acceptors" class="md-nav__link">Hydrogen bond acceptors</a>
        </li>
        <li class="md-nav__item"><a href="#Hydrophobic-contacts" class="md-nav__link">Hydrophobic contacts</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#Collect-coordinates-of-features-per-feature-type" class="md-nav__link">Collect coordinates of features per feature type</a>
        </li>
        <li class="md-nav__item"><a href="#Generate-ensemble-pharmacophores" class="md-nav__link">Generate ensemble pharmacophores</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Set-static-parameters-for-k-means-clustering" class="md-nav__link">Set static parameters for k-means clustering</a>
        </li>
        <li class="md-nav__item"><a href="#Set-static-parameters-for-cluster-selection" class="md-nav__link">Set static parameters for cluster selection</a>
        </li>
        <li class="md-nav__item"><a href="#Define-k-means-clustering-and-cluster-selection-functions" class="md-nav__link">Define k-means clustering and cluster selection functions</a>
        </li>
        <li class="md-nav__item"><a href="#Cluster-features" class="md-nav__link">Cluster features</a>
        </li>
        <li class="md-nav__item"><a href="#Select-relevant-clusters" class="md-nav__link">Select relevant clusters</a>
        </li>
        <li class="md-nav__item"><a href="#Get-selected-cluster-coordinates" class="md-nav__link">Get selected cluster coordinates</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#Show-clusters" class="md-nav__link">Show clusters</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#id1" class="md-nav__link">Hydrogen bond donors</a>
        </li>
        <li class="md-nav__item"><a href="#Hydrogen-bond-acceptor" class="md-nav__link">Hydrogen bond acceptor</a>
        </li>
        <li class="md-nav__item"><a href="#id2" class="md-nav__link">Hydrophobic contacts</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#Show-ensemble-pharmacophore" class="md-nav__link">Show ensemble pharmacophore</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#Discussion" class="md-nav__link">Discussion</a>
        </li>
        <li class="md-nav__item"><a href="#Quiz" class="md-nav__link">Quiz</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../_sources/talktorials/T009_compound_ensemble_pharmacophores.nblink.txt">Show Source</a> </li>

<li id="searchbox" class="md-nav__item"></li>

  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>

<h1 id="talktorials-t009-compound-ensemble-pharmacophores--page-root">T009 ¬∑ Ligand-based pharmacophores<a class="headerlink" href="#talktorials-t009-compound-ensemble-pharmacophores--page-root" title="Permalink to this headline">¬∂</a></h1>
<p>Authors:</p>
<ul class="simple">
<li><p>Pratik Dhakal, CADD seminar, 2017, Charit√©/FU Berlin</p></li>
<li><p>Florian Gusewski, CADD seminar, 2018, Charit√©/FU Berlin</p></li>
<li><p>Jaime Rodr√≠guez-Guerra, <a class="reference external" href="https://volkamerlab.org/">Volkamer lab</a>, Charit√©</p></li>
<li><p>Dominique Sydow, <a class="reference external" href="https://volkamerlab.org/">Volkamer lab</a>, Charit√©</p></li>
</ul>
<p><strong>Talktorial T009</strong>: This talktorial is part of the TeachOpenCADD pipeline described in the <a class="reference external" href="https://jcheminf.biomedcentral.com/articles/10.1186/s13321-019-0351-x">first TeachOpenCADD paper</a>, comprising of talktorials T001-T010.</p>
<p><strong>Note</strong>: Please run this notebook cell by cell. Running all cells in one is possible also, however, part of the nglview 3D representations might be missing.</p>

<h2 id="Aim-of-this-talktorial">Aim of this talktorial<a class="headerlink" href="#Aim-of-this-talktorial" title="Permalink to this headline">¬∂</a></h2>
<p>In this talktorial, we use known EGFR ligands, which were selected and aligned in the previous talktorial, to identify donor, acceptor, and hydrophobic pharmacophoric features for each ligand. Those features are then clustered to define an ensemble pharmacophore, which represents the properties of the set of known EGFR ligands and can be used to search for novel EGFR ligands via virtual screening.</p>


<h2 id="Learning-goals">Learning goals<a class="headerlink" href="#Learning-goals" title="Permalink to this headline">¬∂</a></h2>

<h3 id="Contents-in-Theory">Contents in <em>Theory</em><a class="headerlink" href="#Contents-in-Theory" title="Permalink to this headline">¬∂</a></h3>
<ul class="simple">
<li><p>Pharmacophore modeling</p>
<ul>
<li><p>Structure- and ligand-based pharmacophore modeling</p></li>
</ul>
</li>
<li><p>Virtual screening with pharmacophores</p></li>
<li><p>Clustering: k-means</p></li>
</ul>


<h3 id="Contents-in-Practical">Contents in <em>Practical</em><a class="headerlink" href="#Contents-in-Practical" title="Permalink to this headline">¬∂</a></h3>
<ul class="simple">
<li><p>Get pre-aligned ligands from previous talktorial</p></li>
<li><p>Show ligands with NGLView</p></li>
<li><p>Extract pharmacophore features</p></li>
<li><p>Show the pharmacophore features of all ligands</p>
<ul>
<li><p>Hydrogen bond donors</p></li>
<li><p>Hydrogen bond acceptors</p></li>
<li><p>Hydrophobic contacts</p></li>
</ul>
</li>
<li><p>Collect coordinates of features per feature type</p></li>
<li><p>Generate ensemble pharmacophores</p>
<ul>
<li><p>Set static parameters for k-means clustering</p></li>
<li><p>Set static parameters for cluster selection</p></li>
<li><p>Define k-means clustering and cluster selection functions</p></li>
<li><p>Cluster features</p></li>
<li><p>Select relevant clusters</p></li>
<li><p>Get selected cluster coordinates</p></li>
</ul>
</li>
<li><p>Show clusters</p>
<ul>
<li><p>Hydrogen bond donors</p></li>
<li><p>Hydrogen bond acceptors</p></li>
<li><p>Hydrophobic contacts</p></li>
</ul>
</li>
<li><p>Show ensemble pharmacophore</p></li>
</ul>


<h3 id="References">References<a class="headerlink" href="#References" title="Permalink to this headline">¬∂</a></h3>
<ul class="simple">
<li><p>IUPAC pharmacophore definition (<a class="reference external" href="https://www.degruyter.com/view/journals/pac/70/5/article-p1129.xml">Pure &amp; Appl. Chem (1998), 70, 1129-43</a>)</p></li>
<li><p>3D pharmacophores in LigandScout (<a class="reference external" href="http://pubs.acs.org/doi/pdf/10.1021/ci049885e">J. Chem. Inf. Model. (2005), 45, 160-9</a>)</p></li>
<li><p>Book chapter: Pharmacophore Perception and Applications (<a class="reference external" href="https://onlinelibrary.wiley.com/doi/10.1002/9783527806539.ch6f">Applied Chemoinformatics, Wiley-VCH Verlag GmbH &amp; Co.¬†KGaA, Weinheim, (2018), 1, 259-82</a>)</p></li>
<li><p>Book chapter: Structure-Based Virtual Screening (<a class="reference external" href="https://onlinelibrary.wiley.com/doi/10.1002/9783527806539.ch6h">Applied Chemoinformatics, Wiley-VCH Verlag GmbH &amp; Co.¬†KGaA, Weinheim, (2018), 1, 313-31</a>).</p></li>
<li><p>Monty Kier and the origin of the pharmacophore concept (<a class="reference external" href="http://biochempress.com/Files/iejmd_2007_6_0271.pdf">Internet Electron. J. Mol. Des. (2007), 6, 271-9</a>)</p></li>
<li><p>Nik Stiefl‚Äôs demonstration of pharmacophore modeling with RDKit (<a class="reference external" href="https://github.com/rdkit/UGM_2016/blob/master/Notebooks/Stiefl_RDKitPh4FullPublication.ipynb">RDKit UGM 2016 on GitHub</a>)</p></li>
</ul>



<h2 id="Theory">Theory<a class="headerlink" href="#Theory" title="Permalink to this headline">¬∂</a></h2>

<h3 id="Pharmacophores">Pharmacophores<a class="headerlink" href="#Pharmacophores" title="Permalink to this headline">¬∂</a></h3>
<p>In computer-aided drug design, the description of drug-target interactions with pharmacophores is a well-established method. The term pharmacophore was defined in 1998 by a IUPAC working party: ‚ÄúA pharmacophore is the ensemble of steric and electronic features that is necessary to ensure the optimal supramolecular interactions with a specific biological target structure and to trigger (or to block) its biological response.‚Äù (<a class="reference external" href="https://www.degruyter.com/view/journals/pac/70/5/article-p1129.xml">Pure &amp; Appl. Chem. (1998), 70,
1129-43</a>)</p>
<p>In other words, a <em>pharmacophore</em> consists of several <em>pharmacophoric features</em>, which describe important steric and physico-chemical properties of a ligand observed to bind a target under investigation. Such <em>physico-chemical properties</em> (also called feature types) can be hydrogen bond donors/acceptors, hydrophobic/aromatic interactions, or positively/negatively charged groups, and the <em>steric properties</em> are defined by the 3D arrangement of these features.</p>


<h3 id="Structure--and-ligand-based-pharmacophore-modeling">Structure- and ligand-based pharmacophore modeling<a class="headerlink" href="#Structure--and-ligand-based-pharmacophore-modeling" title="Permalink to this headline">¬∂</a></h3>
<p>In pharmacophore modeling, two main approaches are used, depending on the biological question and available data sources, i.e.¬†structure- and ligand-based pharmacophore modeling.</p>
<p><em>Structure-based pharmacophore models</em> are derived from protein-ligand complexes. Features are defined by observed interactions between the protein and ligand, ensuring that only those ligand moieties are used for virtual screening that have already been shown to be involved in ligand binding. However, structures of protein-ligand complexes are not available for all targets. In this case, either complex structures can be generated by modeling the ligand into the target binding site, e.g.¬†via
molecular docking, or pharmacophore modeling methods can be invoked that only use the target binding site to detect potential protein-ligand interaction sites.</p>
<p><em>Ligand-based pharmacophore models</em> are based on a set of ligands known to bind the target under investigation. The common chemical features of these ligands build the pharmacophore model. This method is used for targets with multiple known ligands and in case of missing protein-ligand complex structures. In this talktorial, we will use ligand-based pharmacophore modeling using a set of known EGFR ligands.</p>
<p>For more information on pharmacophore modeling, we recommend <a class="reference external" href="https://onlinelibrary.wiley.com/doi/10.1002/9783527806539.ch6f">Pharmacophore Perception and Applications: Applied Chemoinformatics, Wiley-VCH Verlag GmbH &amp; Co.¬†KGaA, Weinheim, (2018), 1, 259-82</a> and <a class="reference external" href="http://pubs.acs.org/doi/pdf/10.1021/ci049885e">J. Chem. Inf. Model. (2005), 45, 160-9</a>.</p>
<img alt="Structure-based pharmacophore representing protein-ligand interactions (figure by Dominique Sydow)" src="../_images/target+ligand+pharma_3x_feather.png"/>
<p><em>Figure 1</em>: Structure-based pharmacophore representing protein-ligand interactions. Figure created by Dominique Sydow.</p>


<h3 id="Virtual-screening-with-pharmacophores">Virtual screening with pharmacophores<a class="headerlink" href="#Virtual-screening-with-pharmacophores" title="Permalink to this headline">¬∂</a></h3>
<p>As described earlier in <strong>Talktorial 4</strong>, virtual screening (VS) describes the screening of a query, e.g.¬†a pharmacophore model (T009) or a query compound (T004), against a large library of compounds, in order to identify the small molecules in the library that are most likely to bind a target under investigation (represented by the query). In pharmacophore-based virtual screening, the compound library is matched compound-by-compound into a pharmacophore model and ranked by the best matching
results (<a class="reference external" href="https://onlinelibrary.wiley.com/doi/10.1002/9783527806539.ch6h">Structure-Based Virtual Screening: Applied Chemoinformatics, Wiley-VCH Verlag GmbH &amp; Co.¬†KGaA, Weinheim, (2018), 1, 313-31</a>).</p>


<h3 id="Clustering:-k-means">Clustering: k-means<a class="headerlink" href="#Clustering:-k-means" title="Permalink to this headline">¬∂</a></h3>
<p>In this talktorial we will generate an ensemble pharmacophore by clustering the feature points of several ligand-based pharmacophores. The clustering algorithm uses the k-means clustering, which aims to cluster a data set into k clusters:</p>
<ol class="arabic simple">
<li><p>k different centroids are selected and each point of the data set is assigned to its closest centroids.</p></li>
<li><p>New centroids are calculated based on the current clusters and each point of the data set is newly assigned to its closest centroids.</p></li>
<li><p>This procedure is repeated until the centroids are stable.</p></li>
</ol>
<p>More info about <a class="reference external" href="https://de.wikipedia.org/wiki/K-Means-Algorithmus">k-means in Wikipedia</a>.</p>



<h2 id="Practical">Practical<a class="headerlink" href="#Practical" title="Permalink to this headline">¬∂</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">operator</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">datasets</span><span class="p">,</span> <span class="n">cluster</span>

<span class="kn">from</span> <span class="nn">rdkit</span> <span class="kn">import</span> <span class="n">RDConfig</span><span class="p">,</span> <span class="n">Chem</span><span class="p">,</span> <span class="n">Geometry</span><span class="p">,</span> <span class="n">DistanceGeometry</span>
<span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ChemicalFeatures</span><span class="p">,</span>
    <span class="n">rdDistGeom</span><span class="p">,</span>
    <span class="n">Draw</span><span class="p">,</span>
    <span class="n">rdMolTransforms</span><span class="p">,</span>
    <span class="n">AllChem</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">rdkit.Chem.Draw</span> <span class="kn">import</span> <span class="n">DrawingOptions</span>
<span class="kn">from</span> <span class="nn">rdkit.Chem.Pharm3D</span> <span class="kn">import</span> <span class="n">Pharmacophore</span><span class="p">,</span> <span class="n">EmbedLib</span>
<span class="kn">from</span> <span class="nn">rdkit.Numerics</span> <span class="kn">import</span> <span class="n">rdAlignment</span>
<span class="kn">import</span> <span class="nn">nglview</span> <span class="k">as</span> <span class="nn">nv</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "870d7b54e5ed4fe1a0a11e24066b1245", "version_major": 2, "version_minor": 0}</script></div>
</div>
<p>Set the Path to the current notebook.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">HERE</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">_dh</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">DATA</span> <span class="o">=</span> <span class="n">HERE</span> <span class="o">/</span> <span class="s2">"data"</span>
</pre></div>
</div>
</div>

<h3 id="Get-pre-aligned-ligands-from-previous-talktorial">Get pre-aligned ligands from previous talktorial<a class="headerlink" href="#Get-pre-aligned-ligands-from-previous-talktorial" title="Permalink to this headline">¬∂</a></h3>
<p>We retrieve all ligands that were aligned in the previous talktorial.</p>
<p>First, we get the file paths to all ligand PDB files.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">mol_files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">HERE</span> <span class="o">/</span> <span class="s2">"../T008_query_pdb/data/"</span><span class="p">)</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">"*_lig.pdb"</span><span class="p">))</span>
<span class="nb">print</span><span class="p">([</span><span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">mol_files</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
['3POZ_lig.pdb', '5HG8_lig.pdb', '5UG8_lig.pdb', '5UG9_lig.pdb']
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># NBVAL_CHECK_OUTPUT</span>
<span class="n">pdb_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"_"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">mol_files</span><span class="p">]</span>
<span class="n">pdb_ids</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
['3POZ', '5HG8', '5UG8', '5UG9']
</pre></div></div>
</div>
<p>Second, we read all ligands from these PDB files using RDKit.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># NBVAL_CHECK_OUTPUT</span>
<span class="n">molecules</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">mol_file</span> <span class="ow">in</span> <span class="n">mol_files</span><span class="p">:</span>
    <span class="n">molecule</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromPDBFile</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">mol_file</span><span class="p">),</span> <span class="n">removeHs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">molecule</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">mol_file</span><span class="p">,</span> <span class="s2">"Could not be read"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Chem</span><span class="o">.</span><span class="n">SanitizeMol</span><span class="p">(</span><span class="n">molecule</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">molecule</span><span class="p">))</span>
        <span class="n">molecules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">molecule</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Number of molecules: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">molecules</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
CC(C)(O)CC(O)NCCN1CCC2NCNC(NC3CCC(OC4CCCC(C(F)(F)F)C4)C(Cl)C3)C21
CCC(O)NC1CCCC(OC2NC(NC3CNN(C)C3)NC3NCCC32)C1
CCC(O)NC1CN(C2NC(NC3CNN(C)C3)C3NCN(C(C)C)C3N2)CC1F
CCC(O)NC1CN(C2NC(NC3CN(C)NC3OC)C3NCN(C(C)C)C3N2)CC1F
Number of molecules: 4
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">Draw</span><span class="o">.</span><span class="n">MolsToGridImage</span><span class="p">(</span>
    <span class="n">molecules</span><span class="p">,</span>
    <span class="n">molsPerRow</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">legends</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">"From PDB ID: </span><span class="si">{</span><span class="n">pdb_id</span><span class="si">}</span><span class="s2">"</span> <span class="k">for</span> <span class="n">pdb_id</span> <span class="ow">in</span> <span class="n">pdb_ids</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/talktorials_T009_compound_ensemble_pharmacophores_22_0.png" src="../_images/talktorials_T009_compound_ensemble_pharmacophores_22_0.png"/>
</div>
</div>
<p>Upon inspection of the structures we notice, that we encountered a problem here: When loading ligands from a PDB file, RDKit does not assign bonds in structures like aromatic rings correctly. We use the RDKit function <code class="docutils literal notranslate"><span class="pre">AssignBondOrdersFromTemplate</span></code>, which assigns bonds to a molecule based on a reference molecule, e.g.¬†in our case based on the SMILES pattern of the molecule.</p>
<p>Check for further information: <a class="reference external" href="https://github.com/rdkit/rdkit/issues/1031">RDKit discussion on Aromaticity of non-protein molecules in PDB not detected</a> and <cite>RDKit documentation on ``AssignBondOrdersFromTemplate`</cite> &lt;<a class="reference external" href="http://rdkit.org/docs/source/rdkit.Chem.AllChem.html#AssignBondOrdersFromTemplate">http://rdkit.org/docs/source/rdkit.Chem.AllChem.html#AssignBondOrdersFromTemplate</a>&gt;`__.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Load SMILES for PDB ligand structures</span>
<span class="n">ligands</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">HERE</span> <span class="o">/</span> <span class="s2">"../T008_query_pdb/data/PDB_top_ligands.csv"</span><span class="p">)</span>

<span class="c1"># Get SMILES in the same order as in pdb_ids</span>
<span class="n">ligand_smiles</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">ligands</span><span class="p">[</span><span class="n">ligands</span><span class="p">[</span><span class="s2">"@structureId"</span><span class="p">]</span> <span class="o">==</span> <span class="n">pdb_id</span><span class="p">][</span><span class="s2">"smiles"</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">pdb_id</span> <span class="ow">in</span> <span class="n">pdb_ids</span>
<span class="p">]</span>

<span class="c1"># Generate RDKit Mol object from SMILES</span>
<span class="n">reference_molecules</span> <span class="o">=</span> <span class="p">[</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="n">smiles</span><span class="p">)</span> <span class="k">for</span> <span class="n">smiles</span> <span class="ow">in</span> <span class="n">ligand_smiles</span><span class="p">]</span>

<span class="c1"># Assign bond orders to molecules based on SMILES patterns of reference molecules</span>
<span class="n">molecules</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">AllChem</span><span class="o">.</span><span class="n">AssignBondOrdersFromTemplate</span><span class="p">(</span><span class="n">reference_molecule</span><span class="p">,</span> <span class="n">molecule</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">reference_molecule</span><span class="p">,</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">reference_molecules</span><span class="p">,</span> <span class="n">molecules</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">Draw</span><span class="o">.</span><span class="n">MolsToGridImage</span><span class="p">(</span>
    <span class="n">molecules</span><span class="p">,</span>
    <span class="n">molsPerRow</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">legends</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">"From PDB ID: </span><span class="si">{</span><span class="n">pdb_id</span><span class="si">}</span><span class="s2">"</span> <span class="k">for</span> <span class="n">pdb_id</span> <span class="ow">in</span> <span class="n">pdb_ids</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/talktorials_T009_compound_ensemble_pharmacophores_25_0.png" src="../_images/talktorials_T009_compound_ensemble_pharmacophores_25_0.png"/>
</div>
</div>
<p>Now the correct bonds are included. We can also have a look at the molecules in 2D. In order to keep the original coordinates, we make a copy for the 2D representation.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">molecules_2d</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="n">molecules</span><span class="p">:</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">Mol</span><span class="p">(</span><span class="n">molecule</span><span class="p">)</span>
    <span class="n">AllChem</span><span class="o">.</span><span class="n">Compute2DCoords</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
    <span class="n">molecules_2d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
<span class="n">Draw</span><span class="o">.</span><span class="n">MolsToGridImage</span><span class="p">(</span>
    <span class="n">molecules_2d</span><span class="p">,</span>
    <span class="n">molsPerRow</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">legends</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">"From PDB ID: </span><span class="si">{</span><span class="n">pdb_id</span><span class="si">}</span><span class="s2">"</span> <span class="k">for</span> <span class="n">pdb_id</span> <span class="ow">in</span> <span class="n">pdb_ids</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/talktorials_T009_compound_ensemble_pharmacophores_27_0.png" src="../_images/talktorials_T009_compound_ensemble_pharmacophores_27_0.png"/>
</div>
</div>


<h3 id="Visualize-with-nglview">Visualize with <code class="docutils literal notranslate"><span class="pre">nglview</span></code><a class="headerlink" href="#Visualize-with-nglview" title="Permalink to this headline">¬∂</a></h3>
<p>In the next step we visualize the ligand molecules with nglview using the following function. The molecules will be drawn on top of each other in a single view. This way we are able to visually compare strucural differences between the ligands.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">show_ligands</span><span class="p">(</span><span class="n">molecules</span><span class="p">):</span>
    <span class="sd">"""Generate a view of the ligand molecules.</span>

<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    molecules: list of rdkit.Chem.rdchem.Mol</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    nglview.widget.NGLWidget</span>
<span class="sd">    """</span>
    <span class="n">view</span> <span class="o">=</span> <span class="n">nv</span><span class="o">.</span><span class="n">NGLWidget</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="n">molecules</span><span class="p">:</span>
        <span class="n">component</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">add_component</span><span class="p">(</span><span class="n">molecule</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="n">component</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">component</span><span class="o">.</span><span class="n">add_ball_and_stick</span><span class="p">(</span><span class="n">multipleBond</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">view</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[60]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">view</span> <span class="o">=</span> <span class="n">show_ligands</span><span class="p">(</span><span class="n">molecules</span><span class="p">)</span>
<span class="n">view</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "40d7b6ed97ef46c4893373b3a00d6b10", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[61]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">view</span><span class="o">.</span><span class="n">render_image</span><span class="p">(</span><span class="n">trim</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[62]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">view</span><span class="o">.</span><span class="n">_display_image</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[62]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/talktorials_T009_compound_ensemble_pharmacophores_33_0.png" src="../_images/talktorials_T009_compound_ensemble_pharmacophores_33_0.png"/>
</div>
</div>


<h3 id="Extract-pharmacophore-features">Extract pharmacophore features<a class="headerlink" href="#Extract-pharmacophore-features" title="Permalink to this headline">¬∂</a></h3>
<p>As described above, the aim of this talktorial is to generate a ligand-based ensemble pharmacophore from a set of ligands. First, we need to extract pharmacophore features per ligand. Therefore, we load a feature factory. We use the default feature definitions.</p>
<p>See also the <a class="reference external" href="https://rdkit.readthedocs.io/en/latest/GettingStartedInPython.html#chemical-features-and-pharmacophores">RDKit documentation on chemical features and pharmacophores</a>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">feature_factory</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">BuildFeatureFactory</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">RDConfig</span><span class="o">.</span><span class="n">RDDataDir</span><span class="p">)</span> <span class="o">/</span> <span class="s2">"BaseFeatures.fdef"</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>We take a look at the pharmacophore features that are implemented in RDKit:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">list</span><span class="p">(</span><span class="n">feature_factory</span><span class="o">.</span><span class="n">GetFeatureDefs</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
['Donor.SingleAtomDonor',
 'Acceptor.SingleAtomAcceptor',
 'NegIonizable.AcidicGroup',
 'PosIonizable.BasicGroup',
 'PosIonizable.PosN',
 'PosIonizable.Imidazole',
 'PosIonizable.Guanidine',
 'ZnBinder.ZnBinder1',
 'ZnBinder.ZnBinder2',
 'ZnBinder.ZnBinder3',
 'ZnBinder.ZnBinder4',
 'ZnBinder.ZnBinder5',
 'ZnBinder.ZnBinder6',
 'Aromatic.Arom4',
 'Aromatic.Arom5',
 'Aromatic.Arom6',
 'Aromatic.Arom7',
 'Aromatic.Arom8',
 'Hydrophobe.ThreeWayAttach',
 'Hydrophobe.ChainTwoWayAttach',
 'LumpedHydrophobe.Nitro2',
 'LumpedHydrophobe.RH6_6',
 'LumpedHydrophobe.RH5_5',
 'LumpedHydrophobe.RH4_4',
 'LumpedHydrophobe.RH3_3',
 'LumpedHydrophobe.tButyl',
 'LumpedHydrophobe.iPropyl']
</pre></div></div>
</div>
<p>As an example, we extract all features from the first molecule.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">example_molecule</span> <span class="o">=</span> <span class="n">molecules</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">example_molecule</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/talktorials_T009_compound_ensemble_pharmacophores_39_0.png" src="../_images/talktorials_T009_compound_ensemble_pharmacophores_39_0.png"/>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># NBVAL_CHECK_OUTPUT</span>
<span class="n">features</span> <span class="o">=</span> <span class="n">feature_factory</span><span class="o">.</span><span class="n">GetFeaturesForMol</span><span class="p">(</span><span class="n">example_molecule</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Number of features found: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Number of features found: 17
</pre></div></div>
</div>
<p>The type of a feature is called family in RDKit and can be retrieved with <code class="docutils literal notranslate"><span class="pre">GetFamily()</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># NBVAL_CHECK_OUTPUT</span>
<span class="n">features</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">GetFamily</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
'Donor'
</pre></div></div>
</div>
<p>First we get the frequency of feature types for our example molecule.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># NBVAL_CHECK_OUTPUT</span>
<span class="n">feature_frequency</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">Counter</span><span class="p">([</span><span class="n">feature</span><span class="o">.</span><span class="n">GetFamily</span><span class="p">()</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span><span class="p">])</span>
<span class="n">feature_frequency</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Counter({'Donor': 3,
         'Acceptor': 5,
         'Aromatic': 4,
         'Hydrophobe': 3,
         'LumpedHydrophobe': 2})
</pre></div></div>
</div>
<p>Now apply the functions shown above to all molecules in our ligand set. We calculate the feature type frequency per molecule, then we display it in a DataFrame.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">molecule_feature_frequencies</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="n">molecules</span><span class="p">:</span>
    <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="n">feature</span><span class="o">.</span><span class="n">GetFamily</span><span class="p">()</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">feature_factory</span><span class="o">.</span><span class="n">GetFeaturesForMol</span><span class="p">(</span><span class="n">molecule</span><span class="p">)]</span>
    <span class="n">feature_frequency</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">Counter</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
    <span class="n">molecule_feature_frequencies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feature_frequency</span><span class="p">)</span>

<span class="n">feature_frequencies_df</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="n">molecule_feature_frequencies</span><span class="p">,</span>
        <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">"Mol</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">"</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">molecules</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">feature_frequencies_df</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>Mol1</th>
<th>Mol2</th>
<th>Mol3</th>
<th>Mol4</th>
</tr>
</thead>
<tbody>
<tr>
<th>Donor</th>
<td>3</td>
<td>4</td>
<td>2</td>
<td>2</td>
</tr>
<tr>
<th>Acceptor</th>
<td>5</td>
<td>5</td>
<td>6</td>
<td>7</td>
</tr>
<tr>
<th>Aromatic</th>
<td>4</td>
<td>4</td>
<td>3</td>
<td>3</td>
</tr>
<tr>
<th>Hydrophobe</th>
<td>3</td>
<td>2</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<th>LumpedHydrophobe</th>
<td>2</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<th>PosIonizable</th>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
</tr>
</tbody>
</table>
</div></div>
</div>
<p>Furtheron, we concentrate in this talktorial only on the following feature types: hydrogen bond acceptors (acceptors), hydrogen bond donors (donors), and hydrophobic contacts (hydrophobics).</p>
<p>We retrieve the feature RDKit objects per feature type and per molecule.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">acceptors</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">donors</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">hydrophobics</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="n">molecules</span><span class="p">:</span>
    <span class="n">acceptors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feature_factory</span><span class="o">.</span><span class="n">GetFeaturesForMol</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">includeOnly</span><span class="o">=</span><span class="s2">"Acceptor"</span><span class="p">))</span>
    <span class="n">donors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feature_factory</span><span class="o">.</span><span class="n">GetFeaturesForMol</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">includeOnly</span><span class="o">=</span><span class="s2">"Donor"</span><span class="p">))</span>
    <span class="n">hydrophobics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feature_factory</span><span class="o">.</span><span class="n">GetFeaturesForMol</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">includeOnly</span><span class="o">=</span><span class="s2">"Hydrophobe"</span><span class="p">))</span>

<span class="n">features</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"donors"</span><span class="p">:</span> <span class="n">donors</span><span class="p">,</span>
    <span class="s2">"acceptors"</span><span class="p">:</span> <span class="n">acceptors</span><span class="p">,</span>
    <span class="s2">"hydrophobics"</span><span class="p">:</span> <span class="n">hydrophobics</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div>


<h3 id="Show-the-pharmacophore-features-of-all-ligands">Show the pharmacophore features of all ligands<a class="headerlink" href="#Show-the-pharmacophore-features-of-all-ligands" title="Permalink to this headline">¬∂</a></h3>
<p>Pharmacophore feature types usually are displayed in defined colors, e.g.¬†usually hydrogen bond donors, hydrogen bond acceptors, and hydrophobic contacts are colored green, red, and yellow, respectively.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">feature_colors</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"donors"</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>  <span class="c1"># Green</span>
    <span class="s2">"acceptors"</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>  <span class="c1"># Red</span>
    <span class="s2">"hydrophobics"</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>  <span class="c1"># Yellow</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">visualize_features</span><span class="p">(</span>
    <span class="n">molecules</span><span class="p">,</span>
    <span class="n">features</span><span class="p">,</span>
    <span class="n">feature_type</span><span class="o">=</span><span class="s2">"features"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"yellow"</span><span class="p">,</span>
    <span class="n">sphere_radius</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">"""Generate a view of the molecules highlighting the specified feature type.</span>

<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    molecules: list of rdkit.Chem.rdchem.Mol</span>
<span class="sd">        molecules to be visualized</span>
<span class="sd">    features: list of tuples of rdkit.Chem.rdMolChemicalFeatures.MolChemicalFeature</span>
<span class="sd">        extracted features from molecules chosen to be highlighted</span>
<span class="sd">    feature_type: string, optional</span>
<span class="sd">        name of the feature to be highlighted</span>
<span class="sd">    color: string, optional</span>
<span class="sd">        color used to display the highlighted features</span>
<span class="sd">    sphere_radius: float, optional</span>
<span class="sd">        display size of the highlighted features</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    nglview.widget.NGLWidget</span>
<span class="sd">    """</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Number of </span><span class="si">{</span><span class="n">feature_type</span><span class="si">}</span><span class="s2"> in all ligands: </span><span class="si">{</span><span class="nb">sum</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">features</span><span class="p">])</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="n">view</span> <span class="o">=</span> <span class="n">show_ligands</span><span class="p">(</span><span class="n">molecules</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">feature_set</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">feature_set</span><span class="p">:</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">feature</span><span class="o">.</span><span class="n">GetPos</span><span class="p">())</span>
            <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">feature_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">"</span>
            <span class="n">view</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">add_sphere</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">sphere_radius</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">view</span>
</pre></div>
</div>
</div>
<p>We use this function to visualize the features for the feature types under consideration.</p>

<h4 id="Hydrogen-bond-donors">Hydrogen bond donors<a class="headerlink" href="#Hydrogen-bond-donors" title="Permalink to this headline">¬∂</a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[63]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">feature_type</span> <span class="o">=</span> <span class="s2">"donors"</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">visualize_features</span><span class="p">(</span>
    <span class="n">molecules</span><span class="p">,</span>
    <span class="n">features</span><span class="p">[</span><span class="n">feature_type</span><span class="p">],</span>
    <span class="n">feature_type</span><span class="p">,</span>
    <span class="n">feature_colors</span><span class="p">[</span><span class="n">feature_type</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">view</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Number of donors in all ligands: 11
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "f9383820369e4ae49d1471fdb08e06e6", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[64]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">view</span><span class="o">.</span><span class="n">render_image</span><span class="p">(</span><span class="n">trim</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[65]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">view</span><span class="o">.</span><span class="n">_display_image</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[65]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/talktorials_T009_compound_ensemble_pharmacophores_56_0.png" src="../_images/talktorials_T009_compound_ensemble_pharmacophores_56_0.png"/>
</div>
</div>


<h4 id="Hydrogen-bond-acceptors">Hydrogen bond acceptors<a class="headerlink" href="#Hydrogen-bond-acceptors" title="Permalink to this headline">¬∂</a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[86]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">feature_type</span> <span class="o">=</span> <span class="s2">"acceptors"</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">visualize_features</span><span class="p">(</span>
    <span class="n">molecules</span><span class="p">,</span>
    <span class="n">features</span><span class="p">[</span><span class="n">feature_type</span><span class="p">],</span>
    <span class="n">feature_type</span><span class="p">,</span>
    <span class="n">feature_colors</span><span class="p">[</span><span class="n">feature_type</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">view</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Number of acceptors in all ligands: 23
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "42e4141f71a54143abb3450ee7754056", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[87]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">view</span><span class="o">.</span><span class="n">render_image</span><span class="p">(</span><span class="n">trim</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[88]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">view</span><span class="o">.</span><span class="n">_display_image</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[88]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/talktorials_T009_compound_ensemble_pharmacophores_60_0.png" src="../_images/talktorials_T009_compound_ensemble_pharmacophores_60_0.png"/>
</div>
</div>


<h4 id="Hydrophobic-contacts">Hydrophobic contacts<a class="headerlink" href="#Hydrophobic-contacts" title="Permalink to this headline">¬∂</a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[89]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">feature_type</span> <span class="o">=</span> <span class="s2">"hydrophobics"</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">visualize_features</span><span class="p">(</span>
    <span class="n">molecules</span><span class="p">,</span>
    <span class="n">features</span><span class="p">[</span><span class="n">feature_type</span><span class="p">],</span>
    <span class="n">feature_type</span><span class="p">,</span>
    <span class="n">feature_colors</span><span class="p">[</span><span class="n">feature_type</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">view</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Number of hydrophobics in all ligands: 7
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "1db718d81a25434aa768b72552186d23", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[90]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">view</span><span class="o">.</span><span class="n">render_image</span><span class="p">(</span><span class="n">trim</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[91]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">view</span><span class="o">.</span><span class="n">_display_image</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[91]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/talktorials_T009_compound_ensemble_pharmacophores_64_0.png" src="../_images/talktorials_T009_compound_ensemble_pharmacophores_64_0.png"/>
</div>
</div>



<h3 id="Collect-coordinates-of-features-per-feature-type">Collect coordinates of features per feature type<a class="headerlink" href="#Collect-coordinates-of-features-per-feature-type" title="Permalink to this headline">¬∂</a></h3>
<p>We want to cluster features per feature type. To do this we collect all coordinates of features and store them per feature type.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">features_coord</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"donors"</span><span class="p">:</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">GetPos</span><span class="p">())</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">features</span><span class="p">[</span><span class="s2">"donors"</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">],</span>
    <span class="s2">"acceptors"</span><span class="p">:</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">GetPos</span><span class="p">())</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">features</span><span class="p">[</span><span class="s2">"acceptors"</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">],</span>
    <span class="s2">"hydrophobics"</span><span class="p">:</span> <span class="p">[</span>
        <span class="nb">list</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">GetPos</span><span class="p">())</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">features</span><span class="p">[</span><span class="s2">"hydrophobics"</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span>
    <span class="p">],</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>Now, we have the positions of e.g.¬†all acceptor features:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">features_coord</span><span class="p">[</span><span class="s2">"acceptors"</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[[-10.034, 14.402, -29.697],
 [-7.47, 19.729, -31.685],
 [-10.995, 12.298, -29.29],
 [-12.152, 18.683, -27.243],
 [-11.506, 19.544, -24.341],
 [-13.49, 14.732, -27.925],
 [-11.99, 13.164, -28.961],
 [-13.173, 17.112, -28.025],
 [-16.131, 17.359, -22.003],
 [-16.873, 11.631, -25.856],
 [-13.808, 14.802, -27.137],
 [-12.146, 16.255, -28.067],
 [-11.385, 12.957, -29.278],
 [-16.736, 10.854, -25.879],
 [-15.435, 19.394, -27.21],
 [-16.039, 17.251, -22.54],
 [-13.863, 14.66, -27.134],
 [-12.175, 16.118, -27.994],
 [-11.411, 12.856, -29.266],
 [-17.026, 10.809, -26.396],
 [-15.601, 9.901, -28.086],
 [-15.445, 19.229, -27.215],
 [-16.044, 17.165, -22.506]]
</pre></div></div>
</div>


<h3 id="Generate-ensemble-pharmacophores">Generate ensemble pharmacophores<a class="headerlink" href="#Generate-ensemble-pharmacophores" title="Permalink to this headline">¬∂</a></h3>
<p>In order to generate ensemble pharmacophores, we use k-means clustering to cluster features per feature type.</p>

<h4 id="Set-static-parameters-for-k-means-clustering">Set static parameters for k-means clustering<a class="headerlink" href="#Set-static-parameters-for-k-means-clustering" title="Permalink to this headline">¬∂</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">kq</span></code>: With this paramter, we determine the number of clusters <code class="docutils literal notranslate"><span class="pre">k</span></code> per feature type depending on the number of feature points, i.e.¬†per feature type:</p>
<p><code class="docutils literal notranslate"><span class="pre">k</span></code> = number_of_features / <code class="docutils literal notranslate"><span class="pre">kq</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">kq</span></code> should be selected so that <code class="docutils literal notranslate"><span class="pre">k</span></code> (feature clusters) is for all clusters at least 1 and not larger than 4-5 clusters</p>
<p>We set our ‚Äòkq‚Äô used to determine k in k-means as follows</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">kq</span> <span class="o">=</span> <span class="mi">7</span>
</pre></div>
</div>
</div>


<h4 id="Set-static-parameters-for-cluster-selection">Set static parameters for cluster selection<a class="headerlink" href="#Set-static-parameters-for-cluster-selection" title="Permalink to this headline">¬∂</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">min_cluster_size</span></code>: We only want to retain clusters that potentially contain features from most molecules in our ligand ensemble. Therefore, we set this variable to 75% of the number of molecules in our ligand ensemble.</p>
<p><code class="docutils literal notranslate"><span class="pre">top_cluster_number</span></code>: With this parameter, we select only the largest clusters.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">min_cluster_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">molecules</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.75</span><span class="p">)</span>
<span class="n">top_cluster_number</span> <span class="o">=</span> <span class="mi">4</span>
</pre></div>
</div>
</div>


<h4 id="Define-k-means-clustering-and-cluster-selection-functions">Define k-means clustering and cluster selection functions<a class="headerlink" href="#Define-k-means-clustering-and-cluster-selection-functions" title="Permalink to this headline">¬∂</a></h4>
<p>We define a function that calculates the centers of clusters, which are derived from k-means clustering.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">clustering</span><span class="p">(</span><span class="n">feature_coord</span><span class="p">,</span> <span class="n">kq</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Compute the k-means clustering of input feature coordinates.</span>

<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    feature_coord: list</span>
<span class="sd">        feature coordinates extracted from the features of a set of molecules</span>
<span class="sd">    kq: int</span>
<span class="sd">        Quotient used when calculating number of features k</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    sklearn.cluster._kmeans.KMeans</span>
<span class="sd">    """</span>
    <span class="c1"># Define parameter k as feature number divided by "k quotient"</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">feature_coord</span><span class="p">)</span> <span class="o">/</span> <span class="n">kq</span><span class="p">)</span>
    <span class="c1"># Tailor-made adaption of k for hydrophobics in for the example in this talktorial</span>
    <span class="n">k</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">k</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Clustering: </span><span class="se">\n</span><span class="s2">Variable k in k-means: </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">feature_coord</span><span class="p">)</span><span class="si">}</span><span class="s2"> points</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

    <span class="c1"># Initialize k-means and compute clustering</span>
    <span class="n">k_means</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
    <span class="n">k_means</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">feature_coord</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">k_means</span>
</pre></div>
</div>
</div>
<p>We define a function that sorts the clusters by size and outputs a list of indices of the largest clusters.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">get_clusters</span><span class="p">(</span><span class="n">k_means</span><span class="p">,</span> <span class="n">min_cluster_size</span><span class="p">,</span> <span class="n">top_cluster_number</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Select clusters from a k-means clustering and returns the indices of the selected clusters.</span>
<span class="sd">    The selection is based on cluster size. The largest clusters are chosen.</span>

<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    k_means: sklearn.cluster._kmeans.KMeans</span>
<span class="sd">        k-means clustering of feature coordinates</span>
<span class="sd">    min_cluster_size: int</span>
<span class="sd">        minimum size needed for a cluster to be viable for selection</span>
<span class="sd">    top_cluster_number: int</span>
<span class="sd">        number of clusters to be selected</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    list of int</span>
<span class="sd">        indices of selected clusters</span>
<span class="sd">    """</span>

    <span class="c1"># Sort clusters by size and only show largest</span>
    <span class="n">feature_labels</span> <span class="o">=</span> <span class="n">k_means</span><span class="o">.</span><span class="n">labels_</span>

    <span class="n">feature_labels_count</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">feature_labels</span><span class="p">)</span>

    <span class="n">feature_labels_count</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
        <span class="n">feature_labels_count</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">operator</span><span class="o">.</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Clusters sorted by size: </span><span class="se">\n</span><span class="si">{</span><span class="n">feature_labels_count</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

    <span class="c1"># Get number of the largest clusters, which are larger then the threshold (selected clusters)</span>
    <span class="n">cluster_indices_sel</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">cluster_index</span><span class="p">,</span> <span class="n">cluster_size</span> <span class="ow">in</span> <span class="n">feature_labels_count</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">cluster_size</span> <span class="o">&gt;=</span> <span class="n">min_cluster_size</span> <span class="ow">and</span> <span class="n">top_cluster_number</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">cluster_indices_sel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cluster_index</span><span class="p">)</span>
            <span class="n">top_cluster_number</span> <span class="o">-=</span> <span class="mi">1</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Cluster indices of selected clusters: </span><span class="se">\n</span><span class="si">{</span><span class="n">cluster_indices_sel</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cluster_indices_sel</span>
</pre></div>
</div>
</div>


<h4 id="Cluster-features">Cluster features<a class="headerlink" href="#Cluster-features" title="Permalink to this headline">¬∂</a></h4>
<p>For each feature type, we perform the k-means clustering with our defined <code class="docutils literal notranslate"><span class="pre">clustering</span></code> function.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># NBVAL_CHECK_OUTPUT</span>
<span class="n">k_means</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"donors"</span><span class="p">:</span> <span class="n">clustering</span><span class="p">(</span><span class="n">features_coord</span><span class="p">[</span><span class="s2">"donors"</span><span class="p">],</span> <span class="n">kq</span><span class="p">),</span>
    <span class="s2">"acceptors"</span><span class="p">:</span> <span class="n">clustering</span><span class="p">(</span><span class="n">features_coord</span><span class="p">[</span><span class="s2">"acceptors"</span><span class="p">],</span> <span class="n">kq</span><span class="p">),</span>
    <span class="s2">"hydrophobics"</span><span class="p">:</span> <span class="n">clustering</span><span class="p">(</span><span class="n">features_coord</span><span class="p">[</span><span class="s2">"hydrophobics"</span><span class="p">],</span> <span class="n">kq</span><span class="p">),</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Clustering:
Variable k in k-means: 2 of 11 points

Clustering:
Variable k in k-means: 4 of 23 points

Clustering:
Variable k in k-means: 2 of 7 points

</pre></div></div>
</div>


<h4 id="Select-relevant-clusters">Select relevant clusters<a class="headerlink" href="#Select-relevant-clusters" title="Permalink to this headline">¬∂</a></h4>
<p>For each feature type, we select relevant clusters with our defined <code class="docutils literal notranslate"><span class="pre">get_clusters</span></code> function.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="s2">"Hydrogen bond donors</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="n">cluster_indices_sel_donors</span> <span class="o">=</span> <span class="n">get_clusters</span><span class="p">(</span><span class="n">k_means</span><span class="p">[</span><span class="s2">"donors"</span><span class="p">],</span> <span class="n">min_cluster_size</span><span class="p">,</span> <span class="n">top_cluster_number</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Hydrogen bond donors

Clusters sorted by size:
[(1, 6), (0, 5)]

Cluster indices of selected clusters:
[1, 0]

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="s2">"Hydrogen bond acceptors</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="n">cluster_indices_sel_acceptors</span> <span class="o">=</span> <span class="n">get_clusters</span><span class="p">(</span>
    <span class="n">k_means</span><span class="p">[</span><span class="s2">"acceptors"</span><span class="p">],</span> <span class="n">min_cluster_size</span><span class="p">,</span> <span class="n">top_cluster_number</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Hydrogen bond acceptors

Clusters sorted by size:
[(1, 11), (0, 7), (3, 4), (2, 1)]

Cluster indices of selected clusters:
[1, 0, 3]

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="s2">"Hydrophobic contacts</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="n">cluster_indices_sel_hydrophobic</span> <span class="o">=</span> <span class="n">get_clusters</span><span class="p">(</span>
    <span class="n">k_means</span><span class="p">[</span><span class="s2">"hydrophobics"</span><span class="p">],</span> <span class="n">min_cluster_size</span><span class="p">,</span> <span class="n">top_cluster_number</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Hydrophobic contacts

Clusters sorted by size:
[(1, 4), (0, 3)]

Cluster indices of selected clusters:
[1, 0]

</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">cluster_indices_sel</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"donors"</span><span class="p">:</span> <span class="n">cluster_indices_sel_donors</span><span class="p">,</span>
    <span class="s2">"acceptors"</span><span class="p">:</span> <span class="n">cluster_indices_sel_acceptors</span><span class="p">,</span>
    <span class="s2">"hydrophobics"</span><span class="p">:</span> <span class="n">cluster_indices_sel_hydrophobic</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div>


<h4 id="Get-selected-cluster-coordinates">Get selected cluster coordinates<a class="headerlink" href="#Get-selected-cluster-coordinates" title="Permalink to this headline">¬∂</a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">get_selected_cluster_center_coords</span><span class="p">(</span><span class="n">k_means</span><span class="p">,</span> <span class="n">cluster_indices_sel</span><span class="p">):</span>
    <span class="sd">"""Retrieve cluster center coordinates for selected clusters.</span>
<span class="sd">    The selected clusters are defined by their indices.</span>

<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    k_means: sklearn.cluster._kmeans.KMeans</span>
<span class="sd">        k-means clustering of feature coordinates</span>
<span class="sd">    cluster_indices_sel: list of int</span>
<span class="sd">        indices of the chosen clusters</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    two-dimensional list of floats</span>
<span class="sd">        cluster center coordinates</span>
<span class="sd">    """</span>
    <span class="n">cluster_centers</span> <span class="o">=</span> <span class="n">k_means</span><span class="o">.</span><span class="n">cluster_centers_</span>

    <span class="c1"># Cast to list and then to pandas Series (for element selection by indices)</span>
    <span class="n">cluster_centers</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">cluster_centers</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

    <span class="c1"># Select cluster centers by indices of selected clusters</span>
    <span class="n">cluster_centers_sel</span> <span class="o">=</span> <span class="n">cluster_centers</span><span class="p">[</span><span class="n">cluster_indices_sel</span><span class="p">]</span>

    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">cluster_centers_sel</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">cluster_centers_sel</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"donors"</span><span class="p">:</span> <span class="n">get_selected_cluster_center_coords</span><span class="p">(</span><span class="n">k_means</span><span class="p">[</span><span class="s2">"donors"</span><span class="p">],</span> <span class="n">cluster_indices_sel</span><span class="p">[</span><span class="s2">"donors"</span><span class="p">]),</span>
    <span class="s2">"acceptors"</span><span class="p">:</span> <span class="n">get_selected_cluster_center_coords</span><span class="p">(</span>
        <span class="n">k_means</span><span class="p">[</span><span class="s2">"acceptors"</span><span class="p">],</span> <span class="n">cluster_indices_sel</span><span class="p">[</span><span class="s2">"acceptors"</span><span class="p">]</span>
    <span class="p">),</span>
    <span class="s2">"hydrophobics"</span><span class="p">:</span> <span class="n">get_selected_cluster_center_coords</span><span class="p">(</span>
        <span class="n">k_means</span><span class="p">[</span><span class="s2">"hydrophobics"</span><span class="p">],</span> <span class="n">cluster_indices_sel</span><span class="p">[</span><span class="s2">"hydrophobics"</span><span class="p">]</span>
    <span class="p">),</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">cluster_centers_sel</span><span class="p">[</span><span class="s2">"acceptors"</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[[-12.224545454545455, 14.48690909090909, -28.434],
 [-14.678857142857144, 18.375, -24.722571428571428],
 [-16.559, 10.79875, -26.55425]]
</pre></div></div>
</div>



<h3 id="Show-clusters">Show clusters<a class="headerlink" href="#Show-clusters" title="Permalink to this headline">¬∂</a></h3>
<p>Per feature type, we visualize cluster centers alongside with all molecules and all feature points.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">visualize_clusters</span><span class="p">(</span>
    <span class="n">molecules</span><span class="p">,</span>
    <span class="n">features</span><span class="p">,</span>
    <span class="n">clusters</span><span class="p">,</span>
    <span class="n">feature_type</span><span class="o">=</span><span class="s2">"features"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"yellow"</span><span class="p">,</span>
    <span class="n">feature_radius</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">cluster_radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">"""Visualize the cluster centers.</span>

<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">     molecules: list of rdkit.Chem.rdchem.Mol</span>
<span class="sd">        molecules to be visualized</span>
<span class="sd">    features: list of tuples of rdkit.Chem.rdMolChemicalFeatures.MolChemicalFeature</span>
<span class="sd">        extracted features from molecules chosen to be highlighted</span>
<span class="sd">    clusters: Two-dimensional list of floats</span>
<span class="sd">        cluster center coordinates</span>
<span class="sd">    feature_type: string, optional</span>
<span class="sd">        feature type being visualized</span>
<span class="sd">    color: string, optional</span>
<span class="sd">        color used for rendering the features and cluster centers</span>
<span class="sd">    feature_radius: float, optional</span>
<span class="sd">        rendering size of the features</span>
<span class="sd">    cluster_radius: float, optional</span>
<span class="sd">        rendering size of the cluster centers</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    nglview.widget.NGLWidget</span>
<span class="sd">    """</span>
    <span class="n">view</span> <span class="o">=</span> <span class="n">visualize_features</span><span class="p">(</span>
        <span class="n">molecules</span><span class="p">,</span>
        <span class="n">features</span><span class="p">,</span>
        <span class="n">feature_type</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
        <span class="n">sphere_radius</span><span class="o">=</span><span class="n">feature_radius</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">center</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">clusters</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">view</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">add_sphere</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">center</span><span class="p">),</span> <span class="n">color</span><span class="p">,</span> <span class="n">cluster_radius</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"cluster_</span><span class="si">{</span><span class="n">feature_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">view</span>
</pre></div>
</div>
</div>

<h4 id="id1">Hydrogen bond donors<a class="headerlink" href="#id1" title="Permalink to this headline">¬∂</a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[92]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">feature_type</span> <span class="o">=</span> <span class="s2">"donors"</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">visualize_clusters</span><span class="p">(</span>
    <span class="n">molecules</span><span class="p">,</span>
    <span class="n">features</span><span class="p">[</span><span class="n">feature_type</span><span class="p">],</span>
    <span class="n">cluster_centers_sel</span><span class="p">[</span><span class="n">feature_type</span><span class="p">],</span>
    <span class="n">feature_type</span><span class="p">,</span>
    <span class="n">feature_colors</span><span class="p">[</span><span class="n">feature_type</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">view</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Number of donors in all ligands: 11
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "921c913df65b4eb8bebc5fe397d050d8", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[93]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">view</span><span class="o">.</span><span class="n">render_image</span><span class="p">(</span><span class="n">trim</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[94]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">view</span><span class="o">.</span><span class="n">_display_image</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[94]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/talktorials_T009_compound_ensemble_pharmacophores_94_0.png" src="../_images/talktorials_T009_compound_ensemble_pharmacophores_94_0.png"/>
</div>
</div>


<h4 id="Hydrogen-bond-acceptor">Hydrogen bond acceptor<a class="headerlink" href="#Hydrogen-bond-acceptor" title="Permalink to this headline">¬∂</a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[95]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">feature_type</span> <span class="o">=</span> <span class="s2">"acceptors"</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">visualize_clusters</span><span class="p">(</span>
    <span class="n">molecules</span><span class="p">,</span>
    <span class="n">features</span><span class="p">[</span><span class="n">feature_type</span><span class="p">],</span>
    <span class="n">cluster_centers_sel</span><span class="p">[</span><span class="n">feature_type</span><span class="p">],</span>
    <span class="n">feature_type</span><span class="p">,</span>
    <span class="n">feature_colors</span><span class="p">[</span><span class="n">feature_type</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">view</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Number of acceptors in all ligands: 23
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "102f054b08ed4cc698b78a1e65a823dc", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[97]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">view</span><span class="o">.</span><span class="n">render_image</span><span class="p">(</span><span class="n">trim</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[98]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">view</span><span class="o">.</span><span class="n">_display_image</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[98]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/talktorials_T009_compound_ensemble_pharmacophores_98_0.png" src="../_images/talktorials_T009_compound_ensemble_pharmacophores_98_0.png"/>
</div>
</div>


<h4 id="id2">Hydrophobic contacts<a class="headerlink" href="#id2" title="Permalink to this headline">¬∂</a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[99]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">feature_type</span> <span class="o">=</span> <span class="s2">"hydrophobics"</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">visualize_clusters</span><span class="p">(</span>
    <span class="n">molecules</span><span class="p">,</span>
    <span class="n">features</span><span class="p">[</span><span class="n">feature_type</span><span class="p">],</span>
    <span class="n">cluster_centers_sel</span><span class="p">[</span><span class="n">feature_type</span><span class="p">],</span>
    <span class="n">feature_type</span><span class="p">,</span>
    <span class="n">feature_colors</span><span class="p">[</span><span class="n">feature_type</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">view</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Number of hydrophobics in all ligands: 7
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "a62221dfe63647788e53bc38f661c00e", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[100]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">view</span><span class="o">.</span><span class="n">render_image</span><span class="p">(</span><span class="n">trim</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[101]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">view</span><span class="o">.</span><span class="n">_display_image</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[101]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/talktorials_T009_compound_ensemble_pharmacophores_102_0.png" src="../_images/talktorials_T009_compound_ensemble_pharmacophores_102_0.png"/>
</div>
</div>



<h3 id="Show-ensemble-pharmacophore">Show ensemble pharmacophore<a class="headerlink" href="#Show-ensemble-pharmacophore" title="Permalink to this headline">¬∂</a></h3>
<p>In this last step, we combine the clustered pharmacophoric features (i.e.¬†hydrogen bond donors and acceptors as well as hydrophobic contacts), to one ensemble pharmacophore, representing the pharmacophoric properties of the four selected ligands.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[102]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">view</span> <span class="o">=</span> <span class="n">show_ligands</span><span class="p">(</span><span class="n">molecules</span><span class="p">)</span>
<span class="c1"># Load clusters</span>
<span class="k">for</span> <span class="n">feature_type</span> <span class="ow">in</span> <span class="n">cluster_indices_sel</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">centers</span> <span class="o">=</span> <span class="n">cluster_centers_sel</span><span class="p">[</span><span class="n">feature_type</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">loc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">centers</span><span class="p">):</span>
        <span class="n">sphere_radius</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">feature_color</span> <span class="o">=</span> <span class="n">feature_colors</span><span class="p">[</span><span class="n">feature_type</span><span class="p">]</span>
        <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">feature_type</span><span class="si">}</span><span class="s2">_c</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">"</span>
        <span class="n">view</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">add_sphere</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">feature_color</span><span class="p">,</span> <span class="n">sphere_radius</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
<span class="n">view</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "1de3ccd6da514a38b8a0ed3f699ee85d", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[103]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">view</span><span class="o">.</span><span class="n">render_image</span><span class="p">(</span><span class="n">trim</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[104]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">view</span><span class="o">.</span><span class="n">_display_image</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[104]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/talktorials_T009_compound_ensemble_pharmacophores_106_0.png" src="../_images/talktorials_T009_compound_ensemble_pharmacophores_106_0.png"/>
</div>
</div>



<h2 id="Discussion">Discussion<a class="headerlink" href="#Discussion" title="Permalink to this headline">¬∂</a></h2>
<p>In this talktorial, we used a set of pre-aligned ligands, which are known to bind EGFR, to generate an ensemble pharmacophore model. This model could now be used for virtual screening against a large library of small molecules, in order to find novel small molecules that show the observed steric and physico-chemical properties and might therefore also bind to the EGFR binding site.</p>
<p>Before screening, the pharmacophore models are usually further optimized, e.g.¬†features might be omitted in order to reduce the number of features for screening based on biological knowledge (some interaction might be reported as important whereas others are not) or based on chemical expertise.</p>
<p>We do not cover the virtual screening in this talktorial, however refer to an excellent tutorial by Nik Stiefl, demonstrating pharmacophore modeling and virtual screening with RDKit (<a class="reference external" href="https://github.com/rdkit/UGM_2016/blob/master/Notebooks/Stiefl_RDKitPh4FullPublication.ipynb">RDKit UGM 2016 on GitHub</a>).</p>
<p>We used k-means clustering to cluster pharmacophore feature. This clustering approach has the disadvantage that the user needs to define the number of clusters beforehand, which is usually based on a visual inspection of the point distribution before clustering (or during cluster refinement) and is therefore hindering for an automated pharmacophore generation. Density-based clustering methods, also in combination with k-means clustering, can be a solution for this. For further reading we
recommend the <a class="reference external" href="https://blog.dominodatalab.com/topology-and-density-based-clustering/">introduction to Density-Based Clustering at Domino Data Lab</a>.</p>


<h2 id="Quiz">Quiz<a class="headerlink" href="#Quiz" title="Permalink to this headline">¬∂</a></h2>
<ol class="arabic simple">
<li><p>Explain the terms pharmacophoric features and pharmacophore.</p></li>
<li><p>Explain the difference between structure- and ligand-based pharmacophore modeling.</p></li>
<li><p>Explain how we derived an ensemble pharmacophore.</p></li>
</ol>




          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="T008_query_pdb.html" title="T008 ¬∑ Protein data acquisition: Protein Data Bank (PDB)"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> T008 ¬∑ Protein data acquisition: Protein Data Bank (PDB) </span>
              </div>
            </a>
          
          
            <a href="T010_binding_site_comparison.html" title="T010 ¬∑ Binding site similarity and off-target prediction"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> T010 ¬∑ Binding site similarity and off-target prediction </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright 2018-2021, Volkamer Lab. Project structure based on the Computational Molecular Science Python Cookiecutter version 1.1.
              
          </div>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 3.5.1.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>